<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cold Plunge Streak Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
  <style>
    body {
      background-color: #0b0b0d;
      color: #f5f5f5;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    .app-card {
      max-width: 480px;
      margin: 3rem auto;
      background-color: #15161d;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 0 18px rgba(0, 0, 0, 0.7);
    }
    .day-button {
      width: 2.2rem;
      height: 2.2rem;
      border-radius: 50%;
      border: 1px solid #444;
      background-color: #1b1c23;
      color: #f5f5f5;
      font-size: 0.85rem;
      margin: 0.15rem;
    }
    .day-button.done {
      background-color: #198754;
      border-color: #4ade80;
    }
  </style>
</head>
<body>

<nav class="navbar navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="index.html">← Portfolio</a>
    <a class="nav-link text-light" href="scratch.html">Scratch Page</a>
  </div>
</nav>

<div class="app-card text-center">
  <h1 class="h4 mb-3">Cold Plunge Streak Tracker</h1>
  <p class="small text-muted">
    Tap “Today done” whenever you complete a cold plunge. The app tracks your
    current streak and longest streak in this browser.
  </p>

  <div class="mb-3">
    <div class="h1" id="currentStreak">0</div>
    <div class="small text-muted">Current streak (days)</div>
  </div>
  <div class="mb-3">
    <div class="h4" id="bestStreak">0</div>
    <div class="small text-muted">Best streak</div>
  </div>

  <button id="doneBtn" class="btn btn-success w-100 mb-2">Today done</button>
  <button id="resetBtn" class="btn btn-outline-secondary w-100 btn-sm">Reset data</button>

  <hr class="my-4">

  <h2 class="h6 mb-2">Last 14 days</h2>
  <div id="daysGrid"></div>

  <p class="small text-muted mt-3 mb-0">
    Data is stored locally in your browser (localStorage), so it stays on this device only.
  </p>
</div>

<script>
  const STORAGE_KEY = "coldPlungeData_v1";

  function loadData() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) {
      return { dates: [] };
    }
    try {
      return JSON.parse(raw);
    } catch {
      return { dates: [] };
    }
  }

  function saveData(data) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  function formatDate(d) {
    return d.toISOString().slice(0, 10);
  }

  function calculateStreaks(datesArr) {
    if (datesArr.length === 0) return { current: 0, best: 0 };

    const dates = [...new Set(datesArr)].sort();
    let best = 1;
    let current = 1;

    for (let i = 1; i < dates.length; i++) {
      const prev = new Date(dates[i - 1]);
      const curr = new Date(dates[i]);
      const diff = (curr - prev) / (1000 * 60 * 60 * 24);
      if (diff === 1) {
        current += 1;
      } else if (diff > 1) {
        current = 1;
      }
      if (current > best) best = current;
    }

    const today = formatDate(new Date());
    const last = dates[dates.length - 1];
    if (last !== today) {
      current = 0;
    }

    return { current, best };
  }

  function render() {
    const data = loadData();
    const { current, best } = calculateStreaks(data.dates);
    document.getElementById("currentStreak").textContent = current;
    document.getElementById("bestStreak").textContent = best;

    const grid = document.getElementById("daysGrid");
    grid.innerHTML = "";

    const today = new Date();
    for (let i = 13; i >= 0; i--) {
      const d = new Date(today);
      d.setDate(today.getDate() - i);
      const key = formatDate(d);
      const btn = document.createElement("button");
      btn.className = "day-button";
      btn.textContent = d.getDate();
      if (data.dates.includes(key)) {
        btn.classList.add("done");
      }
      grid.appendChild(btn);
    }
  }

  document.getElementById("doneBtn").addEventListener("click", () => {
    const data = loadData();
    const todayKey = formatDate(new Date());
    if (!data.dates.includes(todayKey)) {
      data.dates.push(todayKey);
      saveData(data);
      render();
    }
  });

  document.getElementById("resetBtn").addEventListener("click", () => {
    if (confirm("Reset all cold plunge data on this device?")) {
      localStorage.removeItem(STORAGE_KEY);
      render();
    }
  });

  render();
</script>

</body>
</html>
